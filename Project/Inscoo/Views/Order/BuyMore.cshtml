@model Models.Order.BuyMoreModel
@{
    ViewBag.Title = "保全操作";
}
@if (!Model.Disable)
{
    <h4 class="text-primary">补充资料</h4>
    using (Html.BeginForm("BuyMore", "Order", FormMethod.Post, new { @class = "orderEntryInfoBody orderEntryInfoBody-loadfile", enctype = "multipart/form-data", onsubmit = Html.Raw("return checkFile(1)") }))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(model => model.Id)
        <ul class="unloadFile">
            <li>
                <label>
                    上传员工名单
                </label>
            </li>
            <li>
                <input type="file" id="empinfo" name="empinfo" />
            </li>
            <li>
                <input type="submit" value="上传" class="btn btn-default" />
                <a href=@Model.EmpInfoFileUrl target="_blank" class="btn btn-default">模版下载</a>
            </li>
            <li>
                @if (Model.HasEmpInfoExcel)
                {
                    <div class="uploadInfo">

                        <div>
                            <ul>
                                <li>
                                    <span><i class="fa fa-check"></i>已上传</span>
                                    <a href="@Model.EmpInfoExcel">查看</a>
                                    @Html.ActionLink("删除", "DeleteFile", new { id = Model.BId, fType = 4 }, new { @style = "color:red;" })
                                </li>
                            </ul>
                        </div>
                    </div>
                }
            </li>
        </ul>
    }
    if (Model.HasEmpInfoExcel)
    {
        <div class="clearfix"></div>
        using (Html.BeginForm("UploadEmpInfoPdf", "Order", FormMethod.Post, new { @class = "orderEntryInfoBody orderEntryInfoBody-loadfile", enctype = "multipart/form-data", onsubmit = Html.Raw("return checkFile('2')") }))
        {
            <ul class="unloadFile">
                <li>
                    <label>
                        加减保员工名单(加盖公章)
                    </label>
                </li>
                <li>
                    <input type="hidden" name="Id" value=@Model.Id />
                    <input type="hidden" name="uType" value="2" />
                    <input type="file" id="EmpInfoPdfSeal" name="EmpInfoPdfSeal" />
                </li>
                <li>
                    <input type="submit" value="上传" class="btn btn-default" />
                    <a href="@Model.EmpInfoFilePDF" target="_blank" class="btn btn-default">名单下载</a>
                </li>
                <li>
                    @if (Model.HasEmpInfoFilePDFSeal)
                    {
                        <div class="uploadInfo">
                            <div>
                                <ul>
                                    <li>
                                        <span><i class="fa fa-check"></i>已上传</span>
                                        <a href="@Model.EmpInfoFilePDFSealUrl">查看</a>
                                        @Html.ActionLink("删除", "DeleteFile", new { id = Model.BId, fType = 5 }, new { @style = "color:red;" })
                                    </li>
                                </ul>
                            </div>
                        </div>
                    }
                </li>
            </ul>
        }
        if (Model.HasPaymentNotice)
        {
            <div class="clearfix"></div>
            <div style="line-height:2em;width:100%;text-align:center;">
                <a href="@Model.PaymentNotice" target="_blank">下载付款通知书</a>
            </div>
        }
    }
}
<div style="line-height:2em;width:100%;text-align:center;">
    <span class="text-danger" style="color:red;" id="error">@Model.Result</span>
</div>
<div class="clearfix"></div>
<h4 class="text-primary">投保变更详细</h4>
@using (Ajax.BeginForm("EmpChanges", null, new AjaxOptions { HttpMethod = "get", UpdateTargetId = "empTempData" }, new { id = "empTempInfo" }))
{
    <input type="hidden" name="Id" value=@Model.Id />
    <div id="empTempData">
        @Html.Action("EmpChanges", new { id = Model.Id })
    </div>
}
<div class="clearfix"></div>
<h4 class="text-primary">已有人员信息</h4>
@using (Ajax.BeginForm("DetailsEmp", null, new AjaxOptions { HttpMethod = "get", UpdateTargetId = "dadaGrid" }, new { id = "employeeInfo" }))
{
    <input type="hidden" name="Id" value=@Model.Id />
    <div id="dadaGrid">
        @Html.Action("DetailsEmp", new { id = Model.Id })
    </div>
}


@section Scripts
    {
    <script>
        function checkFile(e) {
            var s = parseInt(e);
            var errorInfo = $("#error");
            if (e == 1) {
                var empFile = $("#empinfo").val();
                if (empFile == '') {
                    errorInfo.text("未选择任何文件！");
                    return false;
                }
                pf = (empFile.substring(empFile.lastIndexOf(".") + 1, empFile.length)).toLowerCase();
                if (pf == 'xlsx' || pf == 'xls') {
                    return true;
                } else {
                    errorInfo.text("员工名单只能上传Excel文件！");
                    return false;
                }
            }
            if (e == 2) {
                var EmpInfoPdfSeal = $("#EmpInfoPdfSeal").val();
                if (EmpInfoPdfSeal == '') {
                    errorInfo.text("未选择任何文件！");
                    return false;
                }
                pf = (EmpInfoPdfSeal.substring(EmpInfoPdfSeal.lastIndexOf(".") + 1, EmpInfoPdfSeal.length)).toLowerCase();
                if (pf == 'zip' || pf == 'rar') {
                    return true;
                } else {
                    errorInfo.text("员工名单盖章文件请压缩后再上传！");
                    return false;
                }
            }
            return false;
        }
    </script>
}
